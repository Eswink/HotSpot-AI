(()=>{"use strict";var e,t={841:(e,t,o)=>{const i=window.wp.blocks,r=JSON.parse('{"UU":"hotspot-ai/ai-image-search"}'),s=window.wp.i18n,a=window.wp.blockEditor,n=window.wp.components,l=window.wp.element,c=window.wp.apiFetch;var p=o.n(c);const h=window.wp.data,d=window.ReactJSXRuntime,u=({onClose:e,onSelectImage:t})=>{const[o,i]=(0,l.useState)([]),[r,a]=(0,l.useState)(!1),[c,u]=(0,l.useState)(null),[_,g]=(0,l.useState)(""),{createNotice:m}=(0,h.useDispatch)("core/notices");return(0,d.jsxs)(n.Modal,{title:(0,s.__)("AI 智能搜图","hotspot-ai"),onRequestClose:e,children:[(0,d.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,d.jsx)(n.TextControl,{label:(0,s.__)("搜索图片","hotspot-ai"),value:_,onChange:e=>g(e),placeholder:(0,s.__)("输入关键词并点击搜索","hotspot-ai")}),(0,d.jsx)(n.Button,{isPrimary:!0,onClick:()=>{_.trim()?(async e=>{if(a(!0),u(null),window.gutenberg_optimize.search_images_url)try{const t=await p()({path:window.gutenberg_optimize.search_images_url.replace(window.location.origin+"/wp-json/",""),method:"POST",headers:{"X-WP-Nonce":window.gutenberg_optimize.hotspot_nonce},data:{query:e}});t.data?i(t.data):u((0,s.__)("未找到图片，请稍后重试。","hotspot-ai"))}catch(e){u((0,s.__)("加载图片失败，请重新尝试，若多次出现此错误，请反馈作者或加入Q群689155556。","hotspot-ai")),console.error("Error fetching images:",e)}finally{a(!1)}else u((0,s.__)("请先开启智能搜图开关","hotspot-ai"))})(_.trim()):u((0,s.__)("请输入搜索关键词。","hotspot-ai"))},disabled:r,children:r?(0,s.__)("搜索中…","hotspot-ai"):(0,s.__)("搜索","hotspot-ai")})]}),r&&(0,d.jsx)("p",{children:(0,s.__)("加载中，请稍候…","hotspot-ai")})," ",c&&(0,d.jsx)("p",{style:{color:"red"},children:c})," ",!r&&!c&&o.length>0&&(0,d.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"10px",maxWidth:"800px"},children:o.map(((e,o)=>(0,d.jsxs)("div",{style:{textAlign:"center"},children:[(0,d.jsx)("img",{src:e.img_url,alt:e.Photographer||`AI 搜图 ${o+1}`,style:{maxWidth:"100%",cursor:"pointer"},onClick:()=>t(e.img_url)}),(0,d.jsx)("p",{children:e.Photographer})," ",(0,d.jsx)(n.Button,{isSecondary:!0,style:{marginTop:"5px"},onClick:()=>t(e.img_url),children:(0,s.__)("选择图片","hotspot-ai")})]},o)))}),!r&&!c&&0===o.length&&(0,d.jsx)("p",{children:(0,s.__)("未找到相关图片，请尝试其他关键词。","hotspot-ai")})]})},_=window.wp.plugins,g=window.wp.editPost,m=({isModalOpen:e,onClose:t})=>{const[i,r]=(0,l.useState)(!1),{worker:a,initializeWorker:c}=(()=>{const e=(0,l.useRef)(null),t=(0,l.useCallback)((()=>new Promise(((t,i)=>{if(e.current)t(e.current);else try{const i=new Worker(new URL(o.p+o.u(522),o.b));i.addEventListener("terminate",(()=>{console.log("Worker terminated."),e.current=null})),e.current=i,console.log("Worker instance created."),t(i)}catch(e){console.error("Failed to initialize Worker:",e),i(e)}}))),[]),i=(0,l.useCallback)((()=>{e.current&&(e.current.terminate(),e.current=null,console.log("Worker instance destroyed."))}),[]);return(0,l.useEffect)((()=>()=>{i()}),[i]),{workerRef:e,initializeWorker:t,terminateWorker:i}})(),{insertBlocks:p}=(0,h.useDispatch)("core/block-editor"),{createNotice:u}=(0,h.useDispatch)("core/notices"),{editPost:_}=(0,h.useDispatch)("core/editor"),g=(0,h.useSelect)((e=>e("core/editor").getEditedPostAttribute("title"))),[m,w]=(0,l.useState)(g||""),[b,x]=(0,l.useState)(""),k=()=>{i?window.confirm((0,s.__)("当前正在加载，是否强制终止创作进程？","hotspot-ai"))&&(a&&a.terminate(),t()):t()};return e?(0,d.jsxs)(n.Modal,{title:(0,s.__)("AI创作","hotspot-ai"),onRequestClose:k,shouldCloseOnClickOutside:!1,children:[(0,d.jsx)(n.TextControl,{label:(0,s.__)("文章标题","hotspot-ai"),value:m,onChange:e=>{w(e),_({title:e})}}),(0,d.jsxs)("div",{style:{marginTop:"20px"},children:[(0,d.jsx)("p",{children:(0,d.jsxs)("strong",{children:[(0,s.__)("生成内容","hotspot-ai"),":"]})}),(0,d.jsxs)("div",{style:{border:"1px solid #ddd",padding:"10px",minHeight:"100px",backgroundColor:"#f9f9f9",overflow:i?"hidden":"auto",position:"relative"},className:"hotspot-ai-writer-input",children:[i&&(0,d.jsxs)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(255, 255, 255, 0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:10},children:[(0,d.jsx)(n.Spinner,{}),(0,d.jsx)("span",{style:{marginLeft:"10px",fontSize:"16px",color:"#555"},children:(0,s.__)("AI正在构思中","hotspot-ai")})]}),(0,d.jsx)("div",{dangerouslySetInnerHTML:{__html:b}})]})]}),(0,d.jsxs)("div",{style:{marginTop:"20px",display:"flex",justifyContent:"space-between"},children:[(0,d.jsx)(n.Button,{isPrimary:!0,onClick:async()=>{r(!0),x("");try{const e=await c();e.postMessage({url:window.gutenberg_optimize.request_proxy_url,data:{options:{},prompt:g},nonce:window.gutenberg_optimize.hotspot_nonce});const t=await new Promise(((t,o)=>{e.addEventListener("message",(e=>{const{type:i,content:r,error:s}=e.data;"progress"===i?x(r):"done"===i?t("生成完成"):s&&o(s)})),e.addEventListener("error",(e=>{o(e.message)}))}));console.log("AI 响应完成:",t)}catch(e){u("error",(0,s.__)("生成内容失败，请稍后重试。","hotspot-ai"),{isDismissible:!0})}finally{r(!1)}},disabled:i,children:i?(0,s.__)("生成中…","hotspot-ai"):(0,s.__)("AI创作","hotspot-ai")}),(0,d.jsx)(n.Button,{isSecondary:!0,onClick:k,children:(0,s.__)("关闭","hotspot-ai")}),(0,d.jsx)(n.Button,{isPrimary:!0,disabled:i,onClick:()=>{if(b)try{const e=(new DOMParser).parseFromString(b,"text/html").body,o=[];e.childNodes.forEach((e=>{if(e.nodeType===Node.ELEMENT_NODE)if("div"===e.nodeName.toLowerCase())e.childNodes.forEach((e=>{if(e.nodeType===Node.ELEMENT_NODE)switch(e.nodeName.toLowerCase()){case"p":o.push(wp.blocks.createBlock("core/paragraph",{content:e.innerHTML}));break;case"h1":o.push(wp.blocks.createBlock("core/heading",{content:e.innerHTML,level:1}));break;case"h2":case"h3":case"h4":case"h5":case"h6":const t=parseInt(e.nodeName.charAt(1),10);o.push(wp.blocks.createBlock("core/heading",{content:e.innerHTML,level:t}));break;case"ul":case"ol":o.push(wp.blocks.createBlock("core/list",{values:e.innerHTML}));break;case"img":o.push(wp.blocks.createBlock("core/image",{url:e.getAttribute("src"),alt:e.getAttribute("alt")||""}));break;case"blockquote":o.push(wp.blocks.createBlock("core/quote",{value:e.innerHTML}));break;default:o.push(wp.blocks.createBlock("core/html",{content:e.outerHTML}))}}));else switch(e.nodeName.toLowerCase()){case"p":o.push(wp.blocks.createBlock("core/paragraph",{content:e.innerHTML}));break;case"h1":o.push(wp.blocks.createBlock("core/heading",{content:e.innerHTML,level:1}));break;case"h2":case"h3":case"h4":case"h5":case"h6":const t=parseInt(e.nodeName.charAt(1),10);o.push(wp.blocks.createBlock("core/heading",{content:e.innerHTML,level:t}));break;case"ul":case"ol":o.push(wp.blocks.createBlock("core/list",{values:e.innerHTML}));break;case"img":o.push(wp.blocks.createBlock("core/image",{url:e.getAttribute("src"),alt:e.getAttribute("alt")||""}));break;case"blockquote":o.push(wp.blocks.createBlock("core/quote",{value:e.innerHTML}));break;default:o.push(wp.blocks.createBlock("core/html",{content:e.outerHTML}))}})),o.length>0?(p(o),u("success",(0,s.__)("内容已插入编辑器！","hotspot-ai"),{isDismissible:!0}),t()):u("warning",(0,s.__)("生成内容不包含有效的区块！","hotspot-ai"),{isDismissible:!0})}catch(e){u("error",(0,s.__)("解析生成内容时出错，请检查日志！","hotspot-ai"),{isDismissible:!0})}else u("warning",(0,s.__)("生成内容为空，无法插入！","hotspot-ai"),{isDismissible:!0})},children:(0,s.__)("插入内容","hotspot-ai")})]})]}):null},w=()=>{const[e,t]=(0,l.useState)(""),[o,i]=(0,l.useState)(!1),{createNotice:r}=(0,h.useDispatch)("core/notices"),{content:a,title:c}=(0,h.useSelect)((e=>{const t=e("core/editor");return{content:t.getEditedPostContent(),title:t.getEditedPostAttribute("title")}}));return(0,d.jsxs)(n.PanelBody,{title:(0,s.__)("文章SEO","hotspot-ai"),initialOpen:!0,children:[(0,d.jsx)(n.Button,{isPrimary:!0,onClick:async()=>{if(window.gutenberg_optimize.seo_analysis_url||window.gutenberg_optimize.search_images_url){i(!0);try{const e=await p()({path:window.gutenberg_optimize.seo_analysis_url.replace(window.location.origin+"/wp-json/",""),method:"POST",data:{prompt:a}});t(e.data||(0,s.__)("没有可用的分析结果。","hotspot-ai"))}catch(e){console.error("SEO 分析错误:",e.message),t((0,s.__)("SEO 分析失败，请检查日志。","hotspot-ai"))}finally{i(!1)}}else r("error",(0,s.__)("请先开启SEO分析开关","hotspot-ai"),{isDismissible:!0})},disabled:o,style:{marginBottom:"10px"},children:o?(0,d.jsx)(n.Spinner,{}):(0,s.__)("AI分析","hotspot-ai")}),(0,d.jsx)(n.TextareaControl,{label:(0,s.__)("分析结果","hotspot-ai"),value:e,onChange:e=>t(e),placeholder:(0,s.__)("AI分析结果将在这里展现","hotspot-ai")})]})},b=window.wp.editor,x=()=>(0,d.jsx)(n.PanelBody,{title:(0,s.__)("标签","hotspot-ai"),initialOpen:!0,children:(0,d.jsx)(b.PostTaxonomiesFlatTermSelector,{slug:"post_tag",__nextHasNoMarginBottom:!0})}),k=({onAICreation:e})=>(0,d.jsx)(n.PanelBody,{title:(0,s.__)("热点创作","hotspot-ai"),initialOpen:!0,children:(0,d.jsx)(n.Button,{isPrimary:!0,onClick:e,children:(0,s.__)("AI创作","hotspot-ai")})}),j=()=>(0,d.jsx)(n.PanelBody,{title:(0,s.__)("AI辅助撰写","hotspot-ai"),initialOpen:!0,children:(0,d.jsx)("p",{children:"智能构思，创意无限。让AI带您发现文章的更多可能性！"})}),f=()=>{const[e,t]=(0,l.useState)(!1);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(g.PluginSidebar,{name:"hotspot-ai-writer",title:(0,s.__)("Hotspot AI Sidebar","hotspot-ai"),icon:"star-filled",children:[(0,d.jsx)(j,{}),(0,d.jsx)(k,{onAICreation:()=>{t(!0)}}),(0,d.jsx)(w,{}),(0,d.jsx)(x,{})]}),(0,d.jsx)(m,{isModalOpen:e,onClose:()=>{t(!1)}})]})};(0,_.registerPlugin)("hotspot-ai-writer",{render:()=>(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(g.PluginSidebarMoreMenuItem,{target:"hotspot-ai-writer",children:(0,s.__)("Hotspot AI Sidebar","hotspot-ai")}),(0,d.jsx)(f,{})]}),icon:"star-filled"}),(0,i.registerBlockType)(r.UU,{edit:({attributes:e,setAttributes:t,isSelected:o})=>{const{imageUrl:i}=e,r=(0,a.useBlockProps)(),[c,h]=(0,l.useState)(!1),[_,g]=(0,l.useState)(!1),m=()=>g(!1);return(0,d.jsxs)("div",{...r,children:[!i&&(0,d.jsx)("div",{children:(0,d.jsx)(n.Button,{isPrimary:!0,onClick:()=>g(!0),children:(0,s.__)("打开 AI 搜图","hotspot-ai")})}),i&&(0,d.jsxs)("div",{style:{position:"relative",textAlign:"center"},children:[(0,d.jsx)("img",{src:i,alt:(0,s.__)("Selected image","hotspot-ai"),style:{maxWidth:"100%",height:"auto",display:"block",margin:"0 auto"}}),o&&(0,d.jsxs)(n.ToolbarGroup,{children:[(0,d.jsx)(n.ToolbarButton,{label:(0,s.__)("上传到媒体库","hotspot-ai"),onClick:async()=>{if(i){h(!0);try{const e=await fetch(i),o=await e.blob(),r=new FormData;r.append("file",o,`image-${Date.now()}.jpg`);const a=await p()({path:"/wp/v2/media",method:"POST",headers:{"X-WP-Nonce":window.gutenberg_optimize.hotspot_nonce},body:r});a&&a.source_url?(t({imageUrl:a.source_url}),alert((0,s.__)("图片已成功上传到媒体库！","hotspot-ai"))):alert((0,s.__)("上传失败，请稍后重试。","hotspot-ai"))}catch(e){console.error("上传到媒体库失败:",e),alert((0,s.__)("上传失败，请检查网络连接。","hotspot-ai"))}finally{h(!1)}}else alert((0,s.__)("未找到图片，请先插入图片。","hotspot-ai"))},disabled:c,children:c?(0,s.__)("上传中…","hotspot-ai"):(0,s.__)("上传到媒体库","hotspot-ai")}),(0,d.jsx)(n.ToolbarButton,{label:(0,s.__)("移除图片","hotspot-ai"),onClick:()=>t({imageUrl:""}),disabled:c,children:(0,s.__)("移除图片","hotspot-ai")})]})]}),_&&(0,d.jsx)(u,{onClose:m,onSelectImage:e=>{t({imageUrl:e}),m()}})]})},save:({attributes:e})=>{const t=a.useBlockProps.save();return e.imageUrl?(0,d.jsx)("div",{...t,children:(0,d.jsx)("img",{src:e.imageUrl,alt:"AI 搜图",style:{maxWidth:"100%"}})}):null}})}},o={};function i(e){var r=o[e];if(void 0!==r)return r.exports;var s=o[e]={exports:{}};return t[e](s,s.exports,i),s.exports}i.m=t,e=[],i.O=(t,o,r,s)=>{if(!o){var a=1/0;for(p=0;p<e.length;p++){o=e[p][0],r=e[p][1],s=e[p][2];for(var n=!0,l=0;l<o.length;l++)(!1&s||a>=s)&&Object.keys(i.O).every((e=>i.O[e](o[l])))?o.splice(l--,1):(n=!1,s<a&&(a=s));if(n){e.splice(p--,1);var c=r();void 0!==c&&(t=c)}}return t}s=s||0;for(var p=e.length;p>0&&e[p-1][2]>s;p--)e[p]=e[p-1];e[p]=[o,r,s]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},i.u=e=>e+".js?v=1c0f5ab6b9f590781b7a",i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");if(o.length)for(var r=o.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=o[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),(()=>{i.b=document.baseURI||self.location.href;var e={57:0,350:0};i.O.j=t=>0===e[t];var t=(t,o)=>{var r,s,a=o[0],n=o[1],l=o[2],c=0;if(a.some((t=>0!==e[t]))){for(r in n)i.o(n,r)&&(i.m[r]=n[r]);if(l)var p=l(i)}for(t&&t(o);c<a.length;c++)s=a[c],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return i.O(p)},o=self.webpackChunkhotspot_ai_blocks=self.webpackChunkhotspot_ai_blocks||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var r=i.O(void 0,[350],(()=>i(841)));r=i.O(r)})();