(()=>{"use strict";var e,t={710:(e,t,o)=>{const r=window.wp.blocks,a=JSON.parse('{"UU":"hotspot-ai/ai-image-search"}'),n=window.wp.element,i=window.wp.i18n,l=window.wp.blockEditor,s=window.wp.components,c=window.wp.apiFetch;var p=o.n(c);const u=window.wp.data,h=({onClose:e,onSelectImage:t})=>{const[o,r]=(0,n.useState)([]),[a,l]=(0,n.useState)(!1),[c,h]=(0,n.useState)(null),[d,m]=(0,n.useState)(""),{createNotice:_}=(0,u.useDispatch)("core/notices");return(0,n.createElement)(s.Modal,{title:(0,i.__)("AI 智能搜图","hotspot-ai"),onRequestClose:e},(0,n.createElement)("div",{style:{marginBottom:"20px"}},(0,n.createElement)(s.TextControl,{label:(0,i.__)("搜索图片","hotspot-ai"),value:d,onChange:e=>m(e),placeholder:(0,i.__)("输入关键词并点击搜索","hotspot-ai")}),(0,n.createElement)(s.Button,{isPrimary:!0,onClick:()=>{d.trim()?(async e=>{if(l(!0),h(null),window.gutenberg_optimize.search_images_url)try{const t=await p()({path:window.gutenberg_optimize.search_images_url.replace(window.location.origin+"/wp-json/",""),method:"POST",headers:{"X-WP-Nonce":window.gutenberg_optimize.hotspot_nonce},data:{query:e}});t.data?r(t.data):h((0,i.__)("未找到图片，请稍后重试。","hotspot-ai"))}catch(e){h((0,i.__)("加载图片失败，请重新尝试，若多次出现此错误，请反馈作者或加入Q群689155556。","hotspot-ai")),console.error("Error fetching images:",e)}finally{l(!1)}else h((0,i.__)("请先开启智能搜图开关","hotspot-ai"))})(d.trim()):h((0,i.__)("请输入搜索关键词。","hotspot-ai"))},disabled:a},a?(0,i.__)("搜索中…","hotspot-ai"):(0,i.__)("搜索","hotspot-ai"))),a&&(0,n.createElement)("p",null,(0,i.__)("加载中，请稍候…","hotspot-ai"))," ",c&&(0,n.createElement)("p",{style:{color:"red"}},c)," ",!a&&!c&&o.length>0&&(0,n.createElement)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"10px",maxWidth:"800px"}},o.map(((e,o)=>(0,n.createElement)("div",{key:o,style:{textAlign:"center"}},(0,n.createElement)("img",{src:e.img_url,alt:e.Photographer||`AI 搜图 ${o+1}`,style:{maxWidth:"100%",cursor:"pointer"},onClick:()=>t(e.img_url)}),(0,n.createElement)("p",null,e.Photographer)," ",(0,n.createElement)(s.Button,{isSecondary:!0,style:{marginTop:"5px"},onClick:()=>t(e.img_url)},(0,i.__)("选择图片","hotspot-ai")))))),!a&&!c&&0===o.length&&(0,n.createElement)("p",null,(0,i.__)("未找到相关图片，请尝试其他关键词。","hotspot-ai")))},d=window.wp.plugins,m=window.wp.editPost,_=({isModalOpen:e,onClose:t})=>{const[r,a]=(0,n.useState)(!1),{worker:l,initializeWorker:c}=(()=>{const e=(0,n.useRef)(null),t=(0,n.useCallback)((()=>new Promise(((t,r)=>{if(e.current)t(e.current);else try{const r=new Worker(new URL(o.p+o.u(522),o.b));r.addEventListener("terminate",(()=>{console.log("Worker terminated."),e.current=null})),e.current=r,console.log("Worker instance created."),t(r)}catch(e){console.error("Failed to initialize Worker:",e),r(e)}}))),[]),r=(0,n.useCallback)((()=>{e.current&&(e.current.terminate(),e.current=null,console.log("Worker instance destroyed."))}),[]);return(0,n.useEffect)((()=>()=>{r()}),[r]),{workerRef:e,initializeWorker:t,terminateWorker:r}})(),{insertBlocks:p}=(0,u.useDispatch)("core/block-editor"),{createNotice:h}=(0,u.useDispatch)("core/notices"),{editPost:d}=(0,u.useDispatch)("core/editor"),m=(0,u.useSelect)((e=>e("core/editor").getEditedPostAttribute("title"))),[_,g]=(0,n.useState)(m||""),[w,b]=(0,n.useState)(""),k=()=>{r?window.confirm((0,i.__)("当前正在加载，是否强制终止创作进程？","hotspot-ai"))&&(l&&l.terminate(),t()):t()};return e?(0,n.createElement)(s.Modal,{title:(0,i.__)("AI创作","hotspot-ai"),onRequestClose:k,shouldCloseOnClickOutside:!1},(0,n.createElement)(s.TextControl,{label:(0,i.__)("文章标题","hotspot-ai"),value:_,onChange:e=>{g(e),d({title:e})}}),(0,n.createElement)("div",{style:{marginTop:"20px"}},(0,n.createElement)("p",null,(0,n.createElement)("strong",null,(0,i.__)("生成内容","hotspot-ai"),":")),(0,n.createElement)("div",{style:{border:"1px solid #ddd",padding:"10px",minHeight:"100px",backgroundColor:"#f9f9f9",overflow:r?"hidden":"auto",position:"relative"},className:"hotspot-ai-writer-input"},r&&(0,n.createElement)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(255, 255, 255, 0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:10}},(0,n.createElement)(s.Spinner,null),(0,n.createElement)("span",{style:{marginLeft:"10px",fontSize:"16px",color:"#555"}},(0,i.__)("AI正在构思中","hotspot-ai"))),(0,n.createElement)("div",{dangerouslySetInnerHTML:{__html:w}}))),(0,n.createElement)("div",{style:{marginTop:"20px",display:"flex",justifyContent:"space-between"}},(0,n.createElement)(s.Button,{isPrimary:!0,onClick:async()=>{a(!0),b("");try{const e=await c();e.postMessage({url:window.gutenberg_optimize.request_proxy_url,data:{options:{},prompt:m},nonce:window.gutenberg_optimize.hotspot_nonce});const t=await new Promise(((t,o)=>{e.addEventListener("message",(e=>{const{type:r,content:a,error:n}=e.data;"progress"===r?b(a):"done"===r?t("生成完成"):n&&o(n)})),e.addEventListener("error",(e=>{o(e.message)}))}));console.log("AI 响应完成:",t)}catch(e){h("error",(0,i.__)("生成内容失败，请稍后重试。","hotspot-ai"),{isDismissible:!0})}finally{a(!1)}},disabled:r},r?(0,i.__)("生成中…","hotspot-ai"):(0,i.__)("AI创作","hotspot-ai")),(0,n.createElement)(s.Button,{isSecondary:!0,onClick:k},(0,i.__)("关闭","hotspot-ai")),(0,n.createElement)(s.Button,{isPrimary:!0,disabled:r,onClick:()=>{if(w)try{const e=(new DOMParser).parseFromString(w,"text/html").body,o=[];e.childNodes.forEach((e=>{if(e.nodeType===Node.ELEMENT_NODE)if("div"===e.nodeName.toLowerCase())e.childNodes.forEach((e=>{if(e.nodeType===Node.ELEMENT_NODE)switch(e.nodeName.toLowerCase()){case"p":o.push(wp.blocks.createBlock("core/paragraph",{content:e.innerHTML}));break;case"h1":o.push(wp.blocks.createBlock("core/heading",{content:e.innerHTML,level:1}));break;case"h2":case"h3":case"h4":case"h5":case"h6":const t=parseInt(e.nodeName.charAt(1),10);o.push(wp.blocks.createBlock("core/heading",{content:e.innerHTML,level:t}));break;case"ul":case"ol":o.push(wp.blocks.createBlock("core/list",{values:e.innerHTML}));break;case"img":o.push(wp.blocks.createBlock("core/image",{url:e.getAttribute("src"),alt:e.getAttribute("alt")||""}));break;case"blockquote":o.push(wp.blocks.createBlock("core/quote",{value:e.innerHTML}));break;default:o.push(wp.blocks.createBlock("core/html",{content:e.outerHTML}))}}));else switch(e.nodeName.toLowerCase()){case"p":o.push(wp.blocks.createBlock("core/paragraph",{content:e.innerHTML}));break;case"h1":o.push(wp.blocks.createBlock("core/heading",{content:e.innerHTML,level:1}));break;case"h2":case"h3":case"h4":case"h5":case"h6":const t=parseInt(e.nodeName.charAt(1),10);o.push(wp.blocks.createBlock("core/heading",{content:e.innerHTML,level:t}));break;case"ul":case"ol":o.push(wp.blocks.createBlock("core/list",{values:e.innerHTML}));break;case"img":o.push(wp.blocks.createBlock("core/image",{url:e.getAttribute("src"),alt:e.getAttribute("alt")||""}));break;case"blockquote":o.push(wp.blocks.createBlock("core/quote",{value:e.innerHTML}));break;default:o.push(wp.blocks.createBlock("core/html",{content:e.outerHTML}))}})),o.length>0?(p(o),h("success",(0,i.__)("内容已插入编辑器！","hotspot-ai"),{isDismissible:!0}),t()):h("warning",(0,i.__)("生成内容不包含有效的区块！","hotspot-ai"),{isDismissible:!0})}catch(e){h("error",(0,i.__)("解析生成内容时出错，请检查日志！","hotspot-ai"),{isDismissible:!0})}else h("warning",(0,i.__)("生成内容为空，无法插入！","hotspot-ai"),{isDismissible:!0})}},(0,i.__)("插入内容","hotspot-ai")))):null},g=()=>{const[e,t]=(0,n.useState)(""),[o,r]=(0,n.useState)(!1),{createNotice:a}=(0,u.useDispatch)("core/notices"),{content:l,title:c}=(0,u.useSelect)((e=>{const t=e("core/editor");return{content:t.getEditedPostContent(),title:t.getEditedPostAttribute("title")}}));return(0,n.createElement)(s.PanelBody,{title:(0,i.__)("文章SEO","hotspot-ai"),initialOpen:!0},(0,n.createElement)(s.Button,{isPrimary:!0,onClick:async()=>{if(window.gutenberg_optimize.seo_analysis_url||window.gutenberg_optimize.search_images_url){r(!0);try{const e=await p()({path:window.gutenberg_optimize.seo_analysis_url.replace(window.location.origin+"/wp-json/",""),method:"POST",data:{prompt:l}});t(e.data||(0,i.__)("没有可用的分析结果。","hotspot-ai"))}catch(e){console.error("SEO 分析错误:",e.message),t((0,i.__)("SEO 分析失败，请检查日志。","hotspot-ai"))}finally{r(!1)}}else a("error",(0,i.__)("请先开启SEO分析开关","hotspot-ai"),{isDismissible:!0})},disabled:o,style:{marginBottom:"10px"}},o?(0,n.createElement)(s.Spinner,null):(0,i.__)("AI分析","hotspot-ai")),(0,n.createElement)(s.TextareaControl,{label:(0,i.__)("分析结果","hotspot-ai"),value:e,onChange:e=>t(e),placeholder:(0,i.__)("AI分析结果将在这里展现","hotspot-ai")}))},w=window.wp.editor,b=()=>(0,n.createElement)(s.PanelBody,{title:(0,i.__)("标签","hotspot-ai"),initialOpen:!0},(0,n.createElement)(w.PostTaxonomiesFlatTermSelector,{slug:"post_tag",__nextHasNoMarginBottom:!0})),k=({onAICreation:e})=>(0,n.createElement)(s.PanelBody,{title:(0,i.__)("热点创作","hotspot-ai"),initialOpen:!0},(0,n.createElement)(s.Button,{isPrimary:!0,onClick:e},(0,i.__)("AI创作","hotspot-ai"))),E=()=>(0,n.createElement)(s.PanelBody,{title:(0,i.__)("AI辅助撰写","hotspot-ai"),initialOpen:!0},(0,n.createElement)("p",null,"智能构思，创意无限。让AI带您发现文章的更多可能性！")),y=()=>{const[e,t]=(0,n.useState)(!1);return(0,n.createElement)(n.Fragment,null,(0,n.createElement)(m.PluginSidebar,{name:"hotspot-ai-writer",title:(0,i.__)("Hotspot AI Sidebar","hotspot-ai"),icon:"star-filled"},(0,n.createElement)(E,null),(0,n.createElement)(k,{onAICreation:()=>{t(!0)}}),(0,n.createElement)(g,null),(0,n.createElement)(b,null)),(0,n.createElement)(_,{isModalOpen:e,onClose:()=>{t(!1)}}))};(0,d.registerPlugin)("hotspot-ai-writer",{render:()=>(0,n.createElement)(n.Fragment,null,(0,n.createElement)(m.PluginSidebarMoreMenuItem,{target:"hotspot-ai-writer"},(0,i.__)("Hotspot AI Sidebar","hotspot-ai")),(0,n.createElement)(y,null)),icon:"star-filled"}),(0,r.registerBlockType)(a.UU,{edit:({attributes:e,setAttributes:t,isSelected:o})=>{const{imageUrl:r}=e,a=(0,l.useBlockProps)(),[c,u]=(0,n.useState)(!1),[d,m]=(0,n.useState)(!1),_=()=>m(!1);return(0,n.createElement)("div",a,!r&&(0,n.createElement)("div",null,(0,n.createElement)(s.Button,{isPrimary:!0,onClick:()=>m(!0)},(0,i.__)("打开 AI 搜图","hotspot-ai"))),r&&(0,n.createElement)("div",{style:{position:"relative",textAlign:"center"}},(0,n.createElement)("img",{src:r,alt:(0,i.__)("Selected image","hotspot-ai"),style:{maxWidth:"100%",height:"auto",display:"block",margin:"0 auto"}}),o&&(0,n.createElement)(s.ToolbarGroup,null,(0,n.createElement)(s.ToolbarButton,{label:(0,i.__)("上传到媒体库","hotspot-ai"),onClick:async()=>{if(r){u(!0);try{const e=await fetch(r),o=await e.blob(),a=new FormData;a.append("file",o,`image-${Date.now()}.jpg`);const n=await p()({path:"/wp/v2/media",method:"POST",headers:{"X-WP-Nonce":window.gutenberg_optimize.hotspot_nonce},body:a});n&&n.source_url?(t({imageUrl:n.source_url}),alert((0,i.__)("图片已成功上传到媒体库！","hotspot-ai"))):alert((0,i.__)("上传失败，请稍后重试。","hotspot-ai"))}catch(e){console.error("上传到媒体库失败:",e),alert((0,i.__)("上传失败，请检查网络连接。","hotspot-ai"))}finally{u(!1)}}else alert((0,i.__)("未找到图片，请先插入图片。","hotspot-ai"))},disabled:c},c?(0,i.__)("上传中…","hotspot-ai"):(0,i.__)("上传到媒体库","hotspot-ai")),(0,n.createElement)(s.ToolbarButton,{label:(0,i.__)("移除图片","hotspot-ai"),onClick:()=>t({imageUrl:""}),disabled:c},(0,i.__)("移除图片","hotspot-ai")))),d&&(0,n.createElement)(h,{onClose:_,onSelectImage:e=>{t({imageUrl:e}),_()}}))},save:({attributes:e})=>{const t=l.useBlockProps.save();return e.imageUrl?(0,n.createElement)("div",t,(0,n.createElement)("img",{src:e.imageUrl,alt:"AI 搜图",style:{maxWidth:"100%"}})):null}})}},o={};function r(e){var a=o[e];if(void 0!==a)return a.exports;var n=o[e]={exports:{}};return t[e](n,n.exports,r),n.exports}r.m=t,e=[],r.O=(t,o,a,n)=>{if(!o){var i=1/0;for(p=0;p<e.length;p++){o=e[p][0],a=e[p][1],n=e[p][2];for(var l=!0,s=0;s<o.length;s++)(!1&n||i>=n)&&Object.keys(r.O).every((e=>r.O[e](o[s])))?o.splice(s--,1):(l=!1,n<i&&(i=n));if(l){e.splice(p--,1);var c=a();void 0!==c&&(t=c)}}return t}n=n||0;for(var p=e.length;p>0&&e[p-1][2]>n;p--)e[p]=e[p-1];e[p]=[o,a,n]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.u=e=>e+".js",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");if(o.length)for(var a=o.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=o[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{r.b=document.baseURI||self.location.href;var e={57:0,350:0};r.O.j=t=>0===e[t];var t=(t,o)=>{var a,n,i=o[0],l=o[1],s=o[2],c=0;if(i.some((t=>0!==e[t]))){for(a in l)r.o(l,a)&&(r.m[a]=l[a]);if(s)var p=s(r)}for(t&&t(o);c<i.length;c++)n=i[c],r.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return r.O(p)},o=self.webpackChunkhotspot_ai_blocks=self.webpackChunkhotspot_ai_blocks||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var a=r.O(void 0,[350],(()=>r(710)));a=r.O(a)})();